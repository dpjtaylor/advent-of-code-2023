//
//  Day_11Tests.swift
//  AdventOfCode2023Tests
//
//  Created by David Taylor on 20/12/2023.
//

import Foundation
import XCTest
@testable import AdventOfCode2023

final class Day11Tests: XCTestCase {
    
    func test_part1_sampleData() {
        XCTAssertEqual(374, day11_part1(sampleData))
    }
    
    func test_part2_sampleData_factor_2() {
        XCTAssertEqual(374, day11_part2(sampleData, expandFactor: 2))
    }
    
    func test_part2_sampleData_factor_10() {
        XCTAssertEqual(1030, day11_part2(sampleData, expandFactor: 10))
    }
    
    func test_part2_sampleData_factor_100() {
        XCTAssertEqual(8410, day11_part2(sampleData, expandFactor: 100))
    }
    
    func test_part1_puzzleInput() {
        XCTAssertEqual(9_521_776, day11_part1(puzzleInput))
    }
    
    func test_part2_puzzleInput() {
        XCTAssertEqual(553_224_415_344, day11_part2(puzzleInput, expandFactor: 1000_000))
    }
    
    func testShortestPath() {
        let galaxy5 = Galaxy(id: 5, x: 1, y: 6)
        let galaxy9 = Galaxy(id: 9, x: 5, y: 11)
        XCTAssertEqual(9, galaxy5.shortestPath(to: galaxy9))
        XCTAssertEqual(9, galaxy9.shortestPath(to: galaxy5))
        
        let galaxy1 = Galaxy(id: 1, x: 4, y: 0)
        let galaxy7 = Galaxy(id: 7, x: 9, y: 10)
        XCTAssertEqual(15, galaxy1.shortestPath(to: galaxy7))
        XCTAssertEqual(15, galaxy7.shortestPath(to: galaxy1))
        
        let galaxy3 = Galaxy(id: 3, x: 0, y: 2)
        let galaxy6 = Galaxy(id: 6, x: 12, y: 7)
        XCTAssertEqual(17, galaxy3.shortestPath(to: galaxy6))
        XCTAssertEqual(17, galaxy6.shortestPath(to: galaxy3))
        
        let galaxy8 = Galaxy(id: 8, x: 0, y: 11)
        XCTAssertEqual(5, galaxy9.shortestPath(to: galaxy8))
        XCTAssertEqual(5, galaxy8.shortestPath(to: galaxy9))
    }
    
    func testExpandUniverse() {
        XCTAssertEqual(sampleDataExpanded, expandUniverse(sampleData))
    }
    
    func testExtractGalaxies() {
        XCTAssertEqual(9, extractGalaxies(sampleDataExpanded).count)
    }
    
    func testExtractGalaxiesV2() {
        let galaxies = extractGalaxiesV2(sampleDataMappedToInt, expandFactor: 2)
        XCTAssertEqual(9, galaxies.count)
        XCTAssertEqual(Galaxy(id: 1, x: 4, y: 0), galaxies[0])
        XCTAssertEqual(Galaxy(id: 2, x: 9, y: 1), galaxies[1])
        XCTAssertEqual(Galaxy(id: 3, x: 0, y: 2), galaxies[2])
        XCTAssertEqual(Galaxy(id: 4, x: 8, y: 5), galaxies[3])
        XCTAssertEqual(Galaxy(id: 5, x: 1, y: 6), galaxies[4])
        XCTAssertEqual(Galaxy(id: 6, x: 12, y: 7), galaxies[5])
        XCTAssertEqual(Galaxy(id: 7, x: 9, y: 10), galaxies[6])
        XCTAssertEqual(Galaxy(id: 8, x: 0, y: 11), galaxies[7])
        XCTAssertEqual(Galaxy(id: 9, x: 5, y: 11), galaxies[8])
    }
    
    func testExpandUniverseV2() {
        XCTAssertEqual(sampleDataMappedToInt, expandUniverseV2(sampleData))
    }
    
    let sampleDataMappedToInt = [
        [0, 0, 2, 1, 0, 2, 0, 0, 2, 0],
        [0, 0, 2, 0, 0, 2, 0, 1, 2, 0],
        [1, 0, 2, 0, 0, 2, 0, 0, 2, 0],
        [2, 2, 2, 2, 2, 2, 2, 2, 2, 2],
        [0, 0, 2, 0, 0, 2, 1, 0, 2, 0],
        [0, 1, 2, 0, 0, 2, 0, 0, 2, 0],
        [0, 0, 2, 0, 0, 2, 0, 0, 2, 1],
        [2, 2, 2, 2, 2, 2, 2, 2, 2, 2],
        [0, 0, 2, 0, 0, 2, 0, 1, 2, 0],
        [1, 0, 2, 0, 1, 2, 0, 0, 2, 0]
    ]
    
    let sampleData = """
    ...#......
    .......#..
    #.........
    ..........
    ......#...
    .#........
    .........#
    ..........
    .......#..
    #...#.....
    """
    
    // Rows or columns with no galaxies should be twice as big
    let sampleDataExpanded = """
    ....#........
    .........#...
    #............
    .............
    .............
    ........#....
    .#...........
    ............#
    .............
    .............
    .........#...
    #....#.......
    """
    
    let puzzleInput = """
    ...........................#...................#...........................................................................................#
    .................................#..................................................#.................#............#......#.................
    .......................#..................#...............#............#..........................................................#.........
    ..........#........................................#........................#............#.....#..............#.........................#...
    ............................................................................................................................................
    .....#..........#..............#.......#.......................................................................................#............
    .................................................................#...................#..............................#.......................
    ............................................#..............#...............................................................#................
    .........................#..................................................................#..............#................................
    #..................#..............#.........................................................................................................
    ...................................................#.........................#........................................#....................#
    .............#...........................#...............................................#..................................................
    ...........................#...........................#.......................................#............................................
    ......................#..............#..........................#...................................#..............................#........
    ........................................................................................................................................#...
    ...#................................................................................#.......................................................
    .....................................................#....................#.................................#..............#................
    ..............................................#...................................................#..................#......................
    .............#.............#...................................#.....................................................................#......
    ..................#......................................................................#...............#..................................
    ...........................................................................................................................................#
    ......................#.....................#......................................#.............................#.............#............
    ....#.............................................#.............................................#...........................................
    ............#....................#.............................................#............................................................
    #.............................................................#.......#..................................................................#..
    ...........................#.............................................................#...............#..................................
    ......#..................................................#........................................#......................#......#...........
    ...................................................................#.................#...............................................#......
    ......................#.........#...........................................................................................................
    ...............................................................................................#............................#...............
    ........#.......#............................................................#...............................#........#....................#
    ............................................................................................................................................
    ....................................#.......................................................................................................
    ............................................#.........................#.....................................................................
    .#...............................................#..........#....................................................................#..........
    ................................#.................................#......................................#........#.........................
    ...............#.........................#...........#.......................#.....#..............#....................#....................
    ............................................................................................................................................
    .....#.................#......................................................................................#.............................
    ...............................................#...............#...........................................................................#
    .................#..................#......................................#..............#..............................#..................
    ...........................................#........................#............................................#..........................
    ..#......................................................#......................................#...............................#.......#...
    .......#............................................................................#.......................................................
    ...............................#..................#..........................................................#..............#...............
    .....................#................................................#.....................................................................
    ...............#................................................#........................................#..................................
    ...................................#...................................................#....................................................
    ...........................................#..............................#..........................#...............#...............#......
    ..............................#.................................................................................#.............#.............
    .........#.............#.................................#..................................................................................
    ......................................#..............................#.....................................#...............................#
    .................................#..........................................................................................................
    ...............#...............................................................................#..................................#.........
    ..................................................................#......................................................#..................
    #............................................#..........#...............#...........#.......................................................
    .......................................................................................................#....................................
    ............................................................................................................................................
    ............................................................#..............#.....................#..........#.............................#.
    ......#.........................#..........................................................................................#................
    ............#...........#............................................................#......#........................#................#.....
    ........................................#............#..............#.......................................................................
    ...#........................................................................................................................................
    ............................................................................................................................................
    ................#................................#...............#......#...................................................................
    ............................................................................................................................................
    ............#.................#............#...............#................#..............................................................#
    #.......................#............................................................................................................#......
    ..................................#.........................................................#..............................#................
    ......#..........................................................................................................................#..........
    ............................#.................#.......................#..................................#..................................
    ...............#....................................................................................................#.....................#.
    ............................................................................................................................................
    .........#.............................#.........#................#........#........#.......................................................
    ...................#...............................................................................#........................................
    .........................................................#.....................................................#............................
    .#..........................................................................................#................................#..........#...
    .............................................#......................#..................................................#....................
    ..........#..........................................................................#......................................................
    ...........................#......................................................................#.........................................
    .................#........................................#.................................................................................
    .........................................................................#..............#..........................#.................#......
    .................................................................#....................................#.....................................
    ...#.................................#.......................................................................#..............#...............
    ............#.............#........................#........................................................................................
    ....................................................................#..........................#............................................
    .............................................#....................................#.......................#.....#..............#............
    .....................#............#..........................................#.............................................................#
    ............................................................................................................................................
    ..........#....................................................#........................#...................................#...............
    #........................................................................#........................#.........................................
    ................................................#.........#..............................................#.....#......#..........#..........
    ..............#.....#.......................................................................................................................
    ..............................#.............................................#.......#........#.......#...................................#..
    ....................................................#.......................................................................................
    .............................................................#..............................................................................
    .....#........................................#........................................#.............................................#......
    ............................#...............................................................................................................
    .......................#...............................#.................................................#..................................
    ...........#........................#........................................................#.............................#................
    ...........................................................#......#......#...........................#......................................
    #......#..........#............................#.....................................#...................................................#..
    ..............................#................................................#...............................#............................
    .....................................................................#......................................................................
    ........................................#...................................................................................................
    .....................................................#..........#.......................................................#..................#
    .......................#...................................................................#.................#................#.............
    #...........................#..............#..............................#.................................................................
    ............................................................................................................................................
    ........................................................................................................#...................................
    ............#.....#...............#.....................#.........................................................#...................#.....
    ..............................................................#............................................................................#
    .................................................#...................................#......#............................#..................
    ......................................................................................................#.....................................
    ...#.........................#.....................................#...........#................................................#...........
    ................#..............................................................................#.............#..............................
    ......................................#....................................#..............................................................#.
    .........#...............................................#..................................................................................
    .......................#........................#....................#......................#...............................#.....#.........
    ..........................................#............................................................................................#....
    ......#.....#.....................#..............................#.....................#....................................................
    ....................................................#.......................................................................................
    .#......................................................................................................................#...................
    ..................#........#................#...............#.............................#.................................................
    ..........#........................................................................#..............#...........#.....#.......................
    .....................................................................#......................................................................
    ...#.....................................#.....#...........................#..................#.............................................
    ............................................................................................................................................
    .....................................#.................................................................#...................#.......#........
    .......................#........................................#...................#.......................................................
    .....#............#..........#..............................................................................................................
    #.................................................................................................#.............#..............#............
    .........#.......................#..........................................................................................................
    ..................................................................#........................................#................................
    ......................#..............................#.....#...........#....................................................................
    ...........................................#..........................................#...............................................#.....
    ...............................................................................................................#............................
    .............................#..................#............................................#.......................#............#.........
    ................#..............................................................#.....................#......................................
    .......#............................#...................#............#...................................................#..................
    """
}
